{% extends "base.html" %}

{% block title %} {{title}} {% endblock %}

{% block content %}
    {% set href = previous_url %}
    {% include "__title.html" %}

    
        <h2 class="mb-4">Reporte de Trabajo</h2>
        <form method="POST" action="" enctype="multipart/form-data" id="uploadForm">
            {% if wo.code %}
                <label for="wo_code" class="form-label">Actividad:</label>
                <input type="text" name="wo_code" id="wo_code" value="{{ wo.code }}" readonly class="form-control">
            {% endif %}
            <div class="form-group mb-3 row">
                
                <div class="col-sm-6">
                    <label for="mod" class="form-label">Módulo:</label>
                    <input type="text" name="" id="" class="form-control" value="{{mod.name}}" disabled>
                </div>
                
            </div>
            

            <div class="form-group mb-3">
                <label for="activity" class="form-label">Actividad:</label>
                {% if wo.activity %}
                <input type="text" name="activity" id="activity" value="{{ wo.activity }}" readonly class="form-control">
                {% else %}
                <input class="form-control" list="datalistOptions" id="activity" name="activity" placeholder="Ingresa la actividad" {% if form %} value="{{ form.get('activity') }}"  {% endif %} required>
                <datalist id="datalistOptions">
                    {% for activity in activities %}
                    <option value="{{activity.name}}">
                    {% endfor %}
                </datalist>
                {% endif %}
            </div>
            
            <div class="form-group mb-3 row">
                <div class="mb-3 col-md-6">
                    <label for="date" class="form-label">Fecha:</label>
                    <input type="date" class="form-control" id="date" name="date" value="{{today}}" required>
                </div>
                <div class="form-group mb-3 col-md-3">
                    <label for="start_hour" class="form-label">Hora inicio</label>
                    <input type="time" class="form-control" id="start_hour" name="start_hour" {% if form %} value="{{ form.get('start_hour') }}" {% endif %} required>
                </div>
                <div class="form-group mb-3 col-md-3">
                    <label for="end_hour" class="form-label">Hora fin:</label>
                    <input type="time" class="form-control" id="end_hour" name="end_hour" {% if form %} value="{{ form.get('end_hour') }}" {% endif %} required>
                </div>
            </div>

            <div class="form-group mb-3 row">
                <div class="mb-3 col-sm-8">
                    <label for="responsible_id" class="form-label">Responsable:</label>
                    <select id="responsible_id" name="responsible_id" class="form-select" required >
                                
                        {% for user in users %}
      
                            <option value="{{user.id}}" {% if user.id == current_user.id %} selected {% endif %}>{{user.name}}</option>
    
                        {% endfor %}      
                    </select>
                </div>
                
                <div class="form-group mb-3 col-sm-4">
                    <label for="team" class="form-label">Equipo de trabajo:</label>
                    <div id="team-container"></div>
                    <button type="button" id="add-worker" class="btn btn-primary mt-2">
                        Añadir trabajador <i class="bi bi-person-plus"></i>
                    </button>
                </div>
            </div>

            

            <div class="form-group mb-3">
                <label for="description" class="form-label">Descripción de actividad:</label>
                <textarea class="form-control" id="description" name="description" rows="3" required>{% if form %} {{ form.get('description') }} {% endif %}</textarea>
            </div>
            
            <div class="form-group">
                <label for="files" class="form-label">Selecciona las imagenes</label>
                <input type="file" class="form-control" id="files" name="files" accept="image/*" multiple onchange="thumbs_process()" ><br><br>
            </div>
            <div class="row" id="imagePreview">
                
                <!-- Aquí se añadirán las miniaturas de las imágenes -->
            
            </div>
            <div class="form-group mb-3">
                <label for="notes" class="form-label">Observaciones:</label>
                <textarea class="form-control" id="notes" name="notes" rows="3">{% if form %} {{ form.get('notes') }} {% endif %}</textarea>
            </div>
            <button type="submit" class="btn btn-primary">Guardar</button>
        </form>
       
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                var users = JSON.parse('{{ users|tojson|safe }}');
                console.log(users)
                add_workers(users);
            });
        </script>
{% endblock %}

